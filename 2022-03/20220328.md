# 메모리의 구조

어떤 프로그램을 실행하기 위해서는, 가장 먼저 프로그램이 메모리(여기서는 **램**)에 로드되어야합니다.

프로그램은 OS에게 실행에 필요한, 메모리 공간을 할당받는데 이때 메모리 영역은 크게 4가지로 나눠져 있습니다

- 코드 영역
- 데이터 영역
- 스택 영역
- 힙 영역

Q. 그렇다면 8GB의 램을 가지고 있는 내 귀여운 맥북에서는 8GB이상의 용량을 차지하는 프로그램은 돌릴수 없을까?

A. 그럴리가 없져. 가능합니다

한번에 모든 프로그램이 메모리에 올라가있을 필요는 없음! 
실행에 필요한 부분만 메모리에 올려서, 실제 메모리보다 훨씬 더 큰 프로그램을 돌릴수 있게하는 방법이 가상 메모리 기법 (크게 paging과 segment 방식)

또 그 page들을 교체해주는 paging 방법들이 있는데...  
위 내용들은 글의 주제와 매우 벗어나니 추후에 따로 정리할 예정


## 코드영역

- 소스 코드가 기계어 형태로 저장된다
- 컴파일 타임에 결정되고, 코드가 변하면 안되므로 Read-Only 형태로 저장된다


## 데이터 영역

- 전역변수, static변수가 저장된다
- 프로그램 시작과 동시에 할당되고, 프로그램이 종료 되어야 메모리에서 해제된다


음 예를들어서 다음과 같은 코드가 있다고 하면

```swift
struct Camper {
    static var currentProject = "네이버만들기"
    let level: Int
}

let dudu = Camper(level: 999)
```

전역변수인 dudu, static 변수인 currentProject는 모두 데이터 영역에 할당되겠죠? 그리고 이 전체코드의 기계어 버전이 코드 영역에 할당될꺼고요..?

## 스택 영역

- 함수 호출 시 함수의 지역변수, 매개변수, 리턴 값 등등이 저장됨, 해당 함수가 종료되면 저장된 메모리도 해제됨
- 컴파일 타임에 결정된다

## 힙 영역

- 프로그래머가 할당/해제 하는 메모리 영역
- malloc, calloc으로 메모리를 동적 할당한다
- 사용후에는 메모리 해제를 해줘야 함. 아니면 메모리 누수가 발생
- 런타임시 크기가 결정되므로, 데이터의 크기가 정해져있지 않을때 사용

Swift에서는 ARC가 자동으로 메모리를 관리해주기때문에 직접 malloc, calloc을 작성할 필요는 없다!


## 스택 vs 힙
||Stack|Heap|
|--|--|--|
|속도|스택 pointer만 옮겨주면 되기때문에 빠름|할당작업/ 해제작업이 무거워서 속도가 느림|
|접근범위|지역|전역|
|메모리관리|자동|수동|
|크기 제한|있음|없음|

### 사실.. 힙과 스택은 같은 메모리 공간을 공유한다

힙은 낮은 메모리주소부터 채워가고, 스택은 높은 메모리 주소부터 채워간다!




### 참고
- [메모리 구조 - 소들이](https://babbab2.tistory.com/25)